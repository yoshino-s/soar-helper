# https://taskfile.dev
version: '3'

env:
  KO_DOCKER_REPO: ghcr.io/yoshino-s/go-template

tasks:
  tools:
    cmds:
      - echo "Installing tools..."
      - |
        go install \
        github.com/grpc-ecosystem/grpc-gateway/v2/protoc-gen-grpc-gateway \
        github.com/grpc-ecosystem/grpc-gateway/v2/protoc-gen-openapiv2 \
        google.golang.org/protobuf/cmd/protoc-gen-go \
        google.golang.org/grpc/cmd/protoc-gen-go-grpc
      - go install github.com/bufbuild/buf/cmd/buf@v1.31.0
      - go install go install github.com/goreleaser/goreleaser@latest
      - go install github.com/google/ko@latest
    silent: true
  proto:
    cmds:
      - buf generate proto
  build:
    cmds:
      - goreleaser build --snapshot --clean --single-target